<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuickSight Formula Generator </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #FF6B35 0%, #E84118 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .section {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 14px;
        }
        
        select, input, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.3s;
        }
        
        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: #FF6B35;
        }
        
        .btn {
            background: linear-gradient(135deg, #FF6B35 0%, #E84118 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255,107,53,0.3);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .result-container {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 6px;
            border: 2px solid #FF6B35;
            display: none;
        }
        
        .result-container.show {
            display: block;
        }
        
        .result-label {
            font-weight: 600;
            color: #FF6B35;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .formula-output {
            background: white;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            word-wrap: break-word;
            border: 1px solid #ddd;
            margin-bottom: 15px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .copy-btn {
            background: #28a745;
            padding: 10px 20px;
            font-size: 14px;
            width: auto;
            display: inline-block;
        }
        
        .copy-btn:hover {
            background: #218838;
        }
        
        .success-message {
            color: #28a745;
            font-weight: 600;
            margin-top: 10px;
            display: none;
        }
        
        .success-message.show {
            display: block;
        }
        
        .tile-description {
            background: #fff3e0;
            padding: 12px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 13px;
            color: #e65100;
            display: none;
        }
        
        .tile-description.show {
            display: block;
        }

        .note {
            background: #e3f2fd;
            padding: 12px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 13px;
            color: #1565c0;
            border-left: 4px solid #2196f3;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ”§ QuickSight Formula Generator</h1>
            <p>Exact Domo Magic ETL Tile Match - Pick Your Tile & Go!</p>
        </div>
        
        <div class="content">
            <div class="section">
                <label for="tileType">1. Select Your Domo Magic ETL Tile:</label>
                <select id="tileType" onchange="updateFields()">
                    <option value="">-- Choose a Domo Tile (Organized Like Domo) --</option>
                    
                    <optgroup label="ðŸ“Š AGGREGATE">
                        <option value="group_by">Group By</option>
                        <option value="rank">Rank & Window</option>
                    </optgroup>
                    
                    <optgroup label="ðŸ”„ PIVOT">
                        <option value="dynamic_unpivot">Dynamic Unpivot</option>
                        <option value="pivot">Pivot</option>
                        <option value="unpivot">Unpivot</option>
                    </optgroup>
                    
                    <optgroup label="ðŸ” FILTER">
                        <option value="filter_rows">Filter Rows</option>
                        <option value="remove_duplicates">Remove Duplicates</option>
                    </optgroup>
                    
                    <optgroup label="ðŸ”— COMBINE DATA">
                        <option value="append_rows">Append Rows</option>
                        <option value="join_data">Join Data</option>
                    </optgroup>
                    
                    <optgroup label="ðŸ› ï¸ UTILITY">
                        <option value="add_constants">Add Constants</option>
                        <option value="add_formula">Add Formula</option>
                        <option value="alter_columns">Alter Columns</option>
                        <option value="duplicate_column">Duplicate Column</option>
                        <option value="value_mapper">Value Mapper</option>
                    </optgroup>
                    
                    <optgroup label="ðŸ“ TEXT">
                        <option value="combine_columns">Combine Columns</option>
                        <option value="replace_text">Replace Text</option>
                        <option value="split_column">Split Column</option>
                        <option value="string_operations">String Operations</option>
                        <option value="text_formatting">Text Formatting</option>
                    </optgroup>
                    
                    <optgroup label="ðŸ“… DATES AND NUMBERS">
                        <option value="calculator">Calculator</option>
                        <option value="date_operations">Date Operations</option>
                    </optgroup>
                    
                    <optgroup label="ðŸ’¡ COMMON CALCULATIONS">
                        <option value="profit">Profit (Revenue - Cost)</option>
                        <option value="profit_margin">Profit Margin %</option>
                        <option value="percentage">Percentage Calculation</option>
                        <option value="if_then">If-Then Logic</option>
                        <option value="bucket">Bucket/Binning</option>
                        <option value="null_handler">Handle Nulls</option>
                        <option value="running_total">Running Total</option>
                        <option value="lag">Previous Value (LAG)</option>
                    </optgroup>
                </select>
                <div id="tileDescription" class="tile-description"></div>
            </div>
            
            <div id="inputFields" class="section" style="display: none;">
                <label>2. Enter Your Column Names:</label>
                <div id="fieldInputs"></div>
            </div>
            
            <button class="btn" onclick="generateFormula()" id="generateBtn" style="display: none;">
                âœ¨ Generate QuickSight Formula
            </button>
            
            <div id="resultContainer" class="result-container">
                <div class="result-label">Your QuickSight Formula (Ready to Copy!):</div>
                <div id="formulaOutput" class="formula-output"></div>
                <button class="copy-btn" onclick="copyFormula()">ðŸ“‹ Copy Formula</button>
                <div id="successMessage" class="success-message">âœ… Copied to clipboard!</div>
            </div>
        </div>
    </div>

    <script>
        const tileConfigs = {
            // AGGREGATE
            group_by: {
                description: "Domo Tile: Group By | QuickSight: Use visual-level aggregations in your chart",
                fields: [],
                generate: () => `âš ï¸ NOTE: QuickSight doesn't use calculated fields for Group By.

Instead:
1. In your visual, drag your dimension field to the Group/X-axis
2. Drag your measure to Value/Y-axis
3. QuickSight automatically aggregates

Example:
- Drag "Region" to X-axis â†’ Groups by region
- Drag "Sales" to Value â†’ Shows sum(Sales) by region`
            },
            
            rank: {
                description: "Domo Tile: Rank & Window | QuickSight: Use rank() or window functions",
                fields: [
                    {name: 'field', label: 'Field to Rank', placeholder: 'sales'},
                    {name: 'group', label: 'Partition By (Group) - optional', placeholder: 'region'},
                    {name: 'direction', label: 'Direction', type: 'select', options: ['DESC (High to Low)', 'ASC (Low to High)']}
                ],
                generate: (v) => {
                    const dir = v.direction.includes('DESC') ? 'DESC' : 'ASC';
                    return v.group ? 
                        `rank([{${v.field}} ${dir}], [{${v.group}}])` : 
                        `rank([{${v.field}} ${dir}], [])`;
                }
            },
            
            // PIVOT
            dynamic_unpivot: {
                description: "Domo Tile: Dynamic Unpivot | QuickSight: Not directly supported - requires data prep",
                fields: [],
                generate: () => `âš ï¸ QuickSight doesn't have a native unpivot function.

Solutions:
1. Transform data BEFORE importing to QuickSight using:
   - SQL UNPIVOT in your data source
   - Python/Pandas preprocessing
   - AWS Glue ETL job

2. If data is already in QuickSight:
   - You'll need to restructure at the source
   - Or use custom SQL in QuickSight data source connection

Example SQL UNPIVOT:
SELECT id, 'Q1' as quarter, Q1 as value FROM table
UNION ALL
SELECT id, 'Q2' as quarter, Q2 as value FROM table`
            },
            
            pivot: {
                description: "Domo Tile: Pivot | QuickSight: Use Pivot Table visual type",
                fields: [],
                generate: () => `âœ… QuickSight handles pivoting in visuals, not calculated fields.

To create a pivot:
1. Create a new visual
2. Select "Pivot Table" as visual type
3. Drag fields to Rows, Columns, and Values
4. QuickSight automatically pivots the data

Example:
- Rows: Product
- Columns: Month
- Values: sum(Sales)
Result: Products in rows, months in columns`
            },
            
            unpivot: {
                description: "Domo Tile: Unpivot | QuickSight: Same as Dynamic Unpivot - requires data prep",
                fields: [],
                generate: () => `âš ï¸ QuickSight doesn't have a native unpivot function.

See "Dynamic Unpivot" for solutions - same approach applies here.`
            },
            
            // FILTER
            filter_rows: {
                description: "Domo Tile: Filter Rows | QuickSight: Use dataset or visual filters",
                fields: [
                    {name: 'field', label: 'Field to Filter', placeholder: 'status'},
                    {name: 'condition', label: 'Filter Condition', placeholder: '= \'Active\''}
                ],
                generate: (v) => `âœ… QuickSight filters are set in the UI, not with calculated fields.

To filter {${v.field}} ${v.condition}:

OPTION 1 - Dataset Level (applies to all visuals):
1. Edit dataset
2. Click "Add filter"
3. Select {${v.field}}
4. Set condition: ${v.condition}
5. Save dataset

OPTION 2 - Visual Level (single visual only):
1. In your visual
2. Click Filter icon
3. Add filter on {${v.field}}
4. Set condition: ${v.condition}

If you need a FLAG field instead:
${v.condition.includes('=') ? 
`ifelse({${v.field}} ${v.condition}, 1, 0)` :
`ifelse({${v.field}} ${v.condition}, 'Include', 'Exclude')`}`
            },
            
            remove_duplicates: {
                description: "Domo Tile: Remove Duplicates | QuickSight: Use DISTINCT in data source or countDistinct()",
                fields: [],
                generate: () => `âš ï¸ QuickSight doesn't have a "remove duplicates" calculated field.

Solutions:

1. At Data Source (BEST):
   In your SQL query or data source:
   SELECT DISTINCT * FROM your_table
   
2. In Visuals:
   Use distinctCount() instead of count()
   distinctCount({customer_id})
   
3. Pre-process:
   Clean duplicates before importing to QuickSight`
            },
            
            // COMBINE DATA
            append_rows: {
                description: "Domo Tile: Append Rows | QuickSight: Use UNION in data source",
                fields: [],
                generate: () => `âœ… QuickSight handles row appending at the data source level.

To append rows:

OPTION 1 - Custom SQL:
1. In data source setup, use "Custom SQL"
2. Write a UNION query:
   SELECT * FROM table1
   UNION ALL
   SELECT * FROM table2

OPTION 2 - Data Source:
1. Create dataset from first table
2. Click "Edit dataset"
3. Click "Add data"
4. Select second table
5. Choose "Union" join type

Note: Columns must match between datasets!`
            },
            
            join_data: {
                description: "Domo Tile: Join Data | QuickSight: Configure joins in data source setup",
                fields: [],
                generate: () => `âœ… QuickSight handles joins at the data source level.

To join datasets:

1. When creating dataset, select first table
2. Click "Join data"
3. Select second table
4. Choose join type:
   - Inner Join
   - Left Join
   - Right Join
   - Full Outer Join
5. Select join keys (matching columns)
6. Save

Or use Custom SQL:
SELECT * FROM table1 t1
LEFT JOIN table2 t2 ON t1.id = t2.id`
            },
            
            // UTILITY
            add_constants: {
                description: "Domo Tile: Add Constants | QuickSight: Create calculated field with fixed value",
                fields: [
                    {name: 'name', label: 'Constant Name', placeholder: 'company_name'},
                    {name: 'value', label: 'Constant Value', placeholder: 'Acme Corp'}
                ],
                generate: (v) => {
                    const isNumber = !isNaN(v.value);
                    return isNumber ? v.value : `'${v.value}'`;
                }
            },
            
            add_formula: {
                description: "Domo Tile: Add Formula | QuickSight: Create calculated field",
                fields: [
                    {name: 'formula', label: 'Your Formula', type: 'textarea', placeholder: 'Example: {field1} + {field2} * 0.1'}
                ],
                generate: (v) => v.formula
            },
            
            alter_columns: {
                description: "Domo Tile: Alter Columns | QuickSight: Create new calculated field",
                fields: [
                    {name: 'field', label: 'Field to Alter', placeholder: 'price'},
                    {name: 'operation', label: 'Operation', placeholder: '* 1.1 (for 10% increase)'}
                ],
                generate: (v) => `{${v.field}} ${v.operation}`
            },
            
            duplicate_column: {
                description: "Domo Tile: Duplicate Column | QuickSight: Create calculated field that references original",
                fields: [
                    {name: 'field', label: 'Field to Duplicate', placeholder: 'original_field'}
                ],
                generate: (v) => `{${v.field}}`
            },
            
            value_mapper: {
                description: "Domo Tile: Value Mapper | QuickSight: Use CASE WHEN",
                fields: [
                    {name: 'field', label: 'Field to Map', placeholder: 'status_code'},
                    {name: 'mapping', label: 'Mappings (format: old=new, one per line)', type: 'textarea', placeholder: 'A=Active\nI=Inactive\nP=Pending'}
                ],
                generate: (values) => {
                    const mappings = values.mapping.split('\n').filter(m => m.includes('='));
                    let formula = 'CASE\n';
                    mappings.forEach(m => {
                        const [old, newVal] = m.split('=').map(s => s.trim());
                        formula += `  WHEN {${values.field}} = '${old}' THEN '${newVal}'\n`;
                    });
                    formula += `  ELSE {${values.field}}\nEND`;
                    return formula;
                }
            },
            
            // TEXT
            combine_columns: {
                description: "Domo Tile: Combine Columns | QuickSight: Use concat()",
                fields: [
                    {name: 'field1', label: 'First Field', placeholder: 'first_name'},
                    {name: 'field2', label: 'Second Field', placeholder: 'last_name'},
                    {name: 'separator', label: 'Separator', placeholder: ' '}
                ],
                generate: (v) => `concat({${v.field1}}, '${v.separator}', {${v.field2}})`
            },
            
            replace_text: {
                description: "Domo Tile: Replace Text | QuickSight: Use replace()",
                fields: [
                    {name: 'field', label: 'Field Name', placeholder: 'phone_number'},
                    {name: 'old', label: 'Text to Replace', placeholder: '-'},
                    {name: 'new', label: 'Replace With', placeholder: ''}
                ],
                generate: (v) => `replace({${v.field}}, '${v.old}', '${v.new}')`
            },
            
            split_column: {
                description: "Domo Tile: Split Column | QuickSight: Use split()",
                fields: [
                    {name: 'field', label: 'Field Name', placeholder: 'email'},
                    {name: 'delimiter', label: 'Delimiter', placeholder: '@'},
                    {name: 'position', label: 'Position (1 or 2)', placeholder: '2'}
                ],
                generate: (v) => `split({${v.field}}, '${v.delimiter}', ${v.position})`
            },
            
            string_operations: {
                description: "Domo Tile: String Operations | QuickSight: Multiple string functions",
                fields: [
                    {name: 'operation', label: 'Operation', type: 'select', options: ['Upper Case', 'Lower Case', 'Trim', 'Length', 'Substring']},
                    {name: 'field', label: 'Field Name', placeholder: 'text_field'},
                    {name: 'start', label: 'Start Position (for Substring)', placeholder: '1'},
                    {name: 'length', label: 'Length (for Substring)', placeholder: '10'}
                ],
                generate: (v) => {
                    switch(v.operation) {
                        case 'Upper Case': return `toUpper({${v.field}})`;
                        case 'Lower Case': return `toLower({${v.field}})`;
                        case 'Trim': return `trim({${v.field}})`;
                        case 'Length': return `strlen({${v.field}})`;
                        case 'Substring': return `substring({${v.field}}, ${v.start}, ${v.length})`;
                        default: return `toUpper({${v.field}})`;
                    }
                }
            },
            
            text_formatting: {
                description: "Domo Tile: Text Formatting | QuickSight: String manipulation functions",
                fields: [
                    {name: 'operation', label: 'Formatting Type', type: 'select', options: ['Title Case (Capitalize)', 'Remove Spaces', 'Left Pad', 'Right Pad']},
                    {name: 'field', label: 'Field Name', placeholder: 'name'}
                ],
                generate: (v) => {
                    switch(v.operation) {
                        case 'Title Case (Capitalize)':
                            return `# QuickSight doesn't have built-in title case
# Use this workaround:
concat(toUpper(substring({${v.field}}, 1, 1)), toLower(substring({${v.field}}, 2, strlen({${v.field}}))))`;
                        case 'Remove Spaces':
                            return `replace({${v.field}}, ' ', '')`;
                        case 'Left Pad':
                            return `# Use concat to pad left
concat('___', {${v.field}})  # Replace ___ with desired padding`;
                        case 'Right Pad':
                            return `# Use concat to pad right
concat({${v.field}}, '___')  # Replace ___ with desired padding`;
                        default:
                            return `toUpper({${v.field}})`;
                    }
                }
            },
            
            // DATES AND NUMBERS
            calculator: {
                description: "Domo Tile: Calculator | QuickSight: Basic math operations",
                fields: [
                    {name: 'operation', label: 'Operation', type: 'select', options: ['Add (+)', 'Subtract (-)', 'Multiply (*)', 'Divide (/)', 'Power (^)', 'Modulo (%)']},
                    {name: 'field1', label: 'First Number', placeholder: 'quantity'},
                    {name: 'field2', label: 'Second Number', placeholder: 'price'}
                ],
                generate: (v) => {
                    const ops = {
                        'Add (+)': '+',
                        'Subtract (-)': '-',
                        'Multiply (*)': '*',
                        'Divide (/)': '/',
                        'Power (^)': '^',
                        'Modulo (%)': '%'
                    };
                    const op = ops[v.operation];
                    return `{${v.field1}} ${op} {${v.field2}}`;
                }
            },
            
            date_operations: {
                description: "Domo Tile: Date Operations | QuickSight: Date functions",
                fields: [
                    {name: 'operation', label: 'Date Operation', type: 'select', 
                     options: ['Extract Year', 'Extract Month', 'Extract Quarter', 'Extract Day', 'Days Between', 'Add Days', 'Add Months', 'Month Name', 'Day of Week']},
                    {name: 'date1', label: 'Date Field', placeholder: 'order_date'},
                    {name: 'date2', label: 'Second Date (for Days Between)', placeholder: 'ship_date'},
                    {name: 'number', label: 'Number (for Add Days/Months)', placeholder: '30'}
                ],
                generate: (v) => {
                    switch(v.operation) {
                        case 'Extract Year': return `extract('YYYY', {${v.date1}})`;
                        case 'Extract Month': return `extract('MM', {${v.date1}})`;
                        case 'Extract Quarter': return `extract('Q', {${v.date1}})`;
                        case 'Extract Day': return `extract('DD', {${v.date1}})`;
                        case 'Days Between': return `dateDiff({${v.date2}}, {${v.date1}}, 'DD')`;
                        case 'Add Days': return `addDateTime(${v.number}, 'DD', {${v.date1}})`;
                        case 'Add Months': return `addDateTime(${v.number}, 'MM', {${v.date1}})`;
                        case 'Month Name': return `formatDate({${v.date1}}, 'MMMM')`;
                        case 'Day of Week': return `formatDate({${v.date1}}, 'EEEE')`;
                        default: return `extract('YYYY', {${v.date1}})`;
                    }
                }
            },
            
            // COMMON CALCULATIONS
            profit: {
                description: "Calculate Profit: Revenue - Cost",
                fields: [
                    {name: 'revenue', label: 'Revenue Field', placeholder: 'revenue'},
                    {name: 'cost', label: 'Cost Field', placeholder: 'cost'}
                ],
                generate: (v) => `{${v.revenue}} - {${v.cost}}`
            },
            
            profit_margin: {
                description: "Calculate Profit Margin as a Percentage",
                fields: [
                    {name: 'revenue', label: 'Revenue Field', placeholder: 'revenue'},
                    {name: 'cost', label: 'Cost Field', placeholder: 'cost'}
                ],
                generate: (v) => `({${v.revenue}} - {${v.cost}}) / {${v.revenue}} * 100`
            },
            
            percentage: {
                description: "Calculate Percentage: (Part / Total) * 100",
                fields: [
                    {name: 'part', label: 'Part (Numerator)', placeholder: 'actual_sales'},
                    {name: 'total', label: 'Total (Denominator)', placeholder: 'target_sales'}
                ],
                generate: (v) => `({${v.part}} / {${v.total}}) * 100`
            },
            
            if_then: {
                description: "If-Then-Else Conditional Logic",
                fields: [
                    {name: 'field', label: 'Field to Check', placeholder: 'revenue'},
                    {name: 'condition', label: 'Condition', placeholder: '> 1000'},
                    {name: 'true_value', label: 'Value if True', placeholder: 'High'},
                    {name: 'false_value', label: 'Value if False', placeholder: 'Low'}
                ],
                generate: (v) => `ifelse({${v.field}} ${v.condition}, '${v.true_value}', '${v.false_value}')`
            },
            
            bucket: {
                description: "Group Values into Buckets/Categories",
                fields: [
                    {name: 'field', label: 'Field to Bucket', placeholder: 'revenue'},
                    {name: 'ranges', label: 'Ranges (format: <100=Small, <500=Medium, rest=Large)', type: 'textarea', placeholder: '<1000=Small\n<5000=Medium\n>=5000=Large'}
                ],
                generate: (values) => {
                    const ranges = values.ranges.split('\n').filter(r => r.includes('='));
                    let formula = 'CASE\n';
                    ranges.forEach(r => {
                        const [condition, label] = r.split('=').map(s => s.trim());
                        if (condition.startsWith('<')) {
                            const num = condition.substring(1);
                            formula += `  WHEN {${values.field}} < ${num} THEN '${label}'\n`;
                        } else if (condition.startsWith('>=')) {
                            const num = condition.substring(2);
                            formula += `  WHEN {${values.field}} >= ${num} THEN '${label}'\n`;
                        } else {
                            formula += `  ELSE '${label}'\n`;
                        }
                    });
                    formula += 'END';
                    return formula;
                }
            },
            
            null_handler: {
                description: "Replace Null Values with Default",
                fields: [
                    {name: 'field', label: 'Field Name', placeholder: 'discount'},
                    {name: 'default', label: 'Default Value', placeholder: '0'}
                ],
                generate: (v) => {
                    const isNumber = !isNaN(v.default);
                    return isNumber ? 
                        `ifelse(isNull({${v.field}}), ${v.default}, {${v.field}})` :
                        `ifelse(isNull({${v.field}}), '${v.default}', {${v.field}})`;
                }
            },
            
            running_total: {
                description: "Calculate Cumulative Sum Over Time",
                fields: [
                    {name: 'field', label: 'Field to Sum', placeholder: 'sales'},
                    {name: 'sort', label: 'Sort By Field', placeholder: 'order_date'},
                    {name: 'partition', label: 'Partition By (Group) - optional', placeholder: 'region'}
                ],
                generate: (v) => v.partition ?
                    `runningSum({${v.field}}, [{${v.partition}}], [{${v.sort}} ASC])` :
                    `runningSum({${v.field}}, [], [{${v.sort}} ASC])`
            },
            
            lag: {
                description: "Get Value from Previous Row (for Period-over-Period)",
                fields: [
                    {name: 'field', label: 'Field Name', placeholder: 'monthly_sales'},
                    {name: 'offset', label: 'Rows Back (usually 1)', placeholder: '1'},
                    {name: 'sort', label: 'Sort By Field', placeholder: 'month'}
                ],
                generate: (v) => `lag({${v.field}}, [${v.offset}], [], [{${v.sort}} ASC])`
            }
        };

        function updateFields() {
            const tileType = document.getElementById('tileType').value;
            const inputFields = document.getElementById('inputFields');
            const fieldInputs = document.getElementById('fieldInputs');
            const generateBtn = document.getElementById('generateBtn');
            const tileDescription = document.getElementById('tileDescription');
            const resultContainer = document.getElementById('resultContainer');
            
            resultContainer.classList.remove('show');
            
            if (!tileType) {
                inputFields.style.display = 'none';
                generateBtn.style.display = 'none';
                tileDescription.classList.remove('show');
                return;
            }
            
            const config = tileConfigs[tileType];
            tileDescription.textContent = config.description;
            tileDescription.classList.add('show');
            
            fieldInputs.innerHTML = '';
            
            if (config.fields.length === 0) {
                // Tiles that don't need input fields - just generate directly
                inputFields.style.display = 'none';
                generateBtn.style.display = 'block';
                generateBtn.textContent = 'ðŸ“– Show QuickSight Approach';
            } else {
                config.fields.forEach(field => {
                    const div = document.createElement('div');
                    div.style.marginBottom = '15px';
                    
                    const label = document.createElement('label');
                    label.textContent = field.label;
                    div.appendChild(label);
                    
                    if (field.type === 'textarea') {
                        const textarea = document.createElement('textarea');
                        textarea.id = `field_${field.name}`;
                        textarea.placeholder = field.placeholder;
                        textarea.rows = 4;
                        div.appendChild(textarea);
                    } else if (field.type === 'select') {
                        const select = document.createElement('select');
                        select.id = `field_${field.name}`;
                        field.options.forEach(opt => {
                            const option = document.createElement('option');
                            option.value = opt;
                            option.textContent = opt;
                            select.appendChild(option);
                        });
                        div.appendChild(select);
                    } else {
                        const input = document.createElement('input');
                        input.type = 'text';
                        input.id = `field_${field.name}`;
                        input.placeholder = field.placeholder;
                        div.appendChild(input);
                    }
                    
                    fieldInputs.appendChild(div);
                });
                
                inputFields.style.display = 'block';
                generateBtn.style.display = 'block';
                generateBtn.textContent = 'âœ¨ Generate QuickSight Formula';
            }
        }

        function generateFormula() {
            const tileType = document.getElementById('tileType').value;
            const config = tileConfigs[tileType];
            
            if (config.fields.length === 0) {
                // No input needed - just show the result
                const formula = config.generate();
                document.getElementById('formulaOutput').textContent = formula;
                document.getElementById('resultContainer').classList.add('show');
                document.getElementById('successMessage').classList.remove('show');
                document.getElementById('resultContainer').scrollIntoView({ behavior: 'smooth' });
                return;
            }
            
            const values = {};
            config.fields.forEach(field => {
                const input = document.getElementById(`field_${field.name}`);
                values[field.name] = input.value.trim();
            });
            
            // Validate
            for (let key in values) {
                if (!values[key] && tileConfigs[tileType].fields.find(f => f.name === key).label.includes('optional')) {
                    continue; // Skip optional fields
                }
                if (!values[key]) {
                    alert('Please fill in all required fields!');
                    return;
                }
            }
            
            const formula = config.generate(values);
            
            document.getElementById('formulaOutput').textContent = formula;
            document.getElementById('resultContainer').classList.add('show');
            document.getElementById('successMessage').classList.remove('show');
            
            document.getElementById('resultContainer').scrollIntoView({ behavior: 'smooth' });
        }

        function copyFormula() {
            const formula = document.getElementById('formulaOutput').textContent;
            navigator.clipboard.writeText(formula).then(() => {
                const successMsg = document.getElementById('successMessage');
                successMsg.classList.add('show');
                setTimeout(() => {
                    successMsg.classList.remove('show');
                }, 3000);
            });
        }
    </script>
</body>
</html>
